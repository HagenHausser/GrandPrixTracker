package com.example.GrandPrixTracker.service;

import com.example.GrandPrixTracker.apiClient.ErgastApiClient;
import com.example.GrandPrixTracker.model.dto.GrandPrixDto;
import com.example.GrandPrixTracker.model.dto.RaceDto;
import com.example.GrandPrixTracker.model.dto.RaceResultPositionDto;
import com.example.GrandPrixTracker.model.ergastModel.ErgastRace;
import com.example.GrandPrixTracker.model.ergastModel.ErgastResponse;
import com.example.GrandPrixTracker.repository.FavouriteRaceRepository;
import com.fasterxml.jackson.core.type.TypeReference;
import com.fasterxml.jackson.databind.ObjectMapper;
import org.junit.jupiter.api.BeforeEach;
import org.junit.jupiter.api.DisplayName;
import org.junit.jupiter.api.Test;
import org.mockito.Mockito;

import java.lang.reflect.Field;
import java.util.List;
import java.util.concurrent.CompletableFuture;

import static org.junit.jupiter.api.Assertions.*;
import static org.mockito.ArgumentMatchers.any;
import static org.mockito.Mockito.when;

class ErgastServiceTest {
    private ErgastService ergastService;
    private final ErgastApiClient ergastApiClient = ErgastApiClient.create();
    private FavouriteRaceService favouriteRaceService;

    @BeforeEach
    void setUp() {
        try {
            favouriteRaceService = new FavouriteRaceService(Mockito.mock(FavouriteRaceRepository.class));
            ergastService = new ErgastService(favouriteRaceService);
            Field apiClientField = ErgastService.class.getDeclaredField("ergastClient");
            apiClientField.setAccessible(true);
            apiClientField.set(ergastService, ergastApiClient);
        } catch(Exception exc) {
            System.out.println(exc.getMessage());
        }
    }

    @Test
    @DisplayName("tests if RaceDto returns the correct race result data")
    void getRaceResults_validate_data() {
        try {
            when(ergastApiClient.getRaceResult(2015, 3)).thenReturn(raceResultData());

            RaceDto race = ergastService.getRaceResults(2015, 3);

            assertEquals(race.country,"China");
            assertEquals(race.locality, "Shanghai");
            assertEquals(race.positions.size(), 20);

            RaceResultPositionDto winnerPosition = race.positions.get(0);
            assertEquals(winnerPosition.driver, "Lewis Hamilton");
            assertEquals(winnerPosition.points, 25);
            assertEquals(winnerPosition.fastestLap, true);
        } catch (Exception exc) {
            System.out.println(exc.getMessage());
        }
    }

    @Test
    @DisplayName("test if returned race is not a favourite")
    void getRaceResults_not_favourite() {
        try {
            when(ergastApiClient.getRaceResult(2015, 3)).thenReturn(raceResultData());

            RaceDto race = ergastService.getRaceResults(2015, 3);

            assertEquals(race.isFavourite, false);
        } catch (Exception exc) {
            System.out.println(exc.getMessage());
        }
    }

    @Test
    @DisplayName("tests weither or not the returned is a favourite")
    void getRaceResults_favourite() {
        try {
            when(ergastApiClient.getRaceResult(2015, 3)).thenReturn(raceResultData());
            when(favouriteRaceService.isFavourite(any(ErgastRace.class))).thenReturn(true);

            RaceDto race = ergastService.getRaceResults(2015, 3);

            assertEquals(race.isFavourite, true);
        } catch (Exception exc) {
            System.out.println(exc.getMessage());
        }
    }

    @Test
    @DisplayName("tests if the correct season opener is returned")
    void getSeasonGrandPrixs_test_2015_season_opener() {
        try {
            when(ergastApiClient.getSeasonGrandPrixs(2015)).thenReturn(grandPrixData());

            List<GrandPrixDto> grandPrixs = ergastService.getSeasonGrandPrixs(2015);
            assertEquals(grandPrixs.get(0).raceName, "Australian Grand Prix");
        } catch(Exception exc) {
            System.out.println(exc.getMessage());
        }
    }

    @Test
    @DisplayName("tests if the correct amount of races in a season is returned")
    void getSeasonGrandPrixs_test_2015_seasons_race_amount() {
        try {
            when(ergastApiClient.getSeasonGrandPrixs(2015)).thenReturn(grandPrixData());

            List<GrandPrixDto> grandPrixs = ergastService.getSeasonGrandPrixs(2015);
            assertEquals(grandPrixs.size(), 19);
        } catch(Exception exc) {
            System.out.println(exc.getMessage());
        }
    }

    private CompletableFuture<ErgastResponse<ErgastRace>> grandPrixData() {
        String jsonResponse = "{\"MRData\":{\"xmlns\":\"http:\\/\\/ergast.com\\/mrd\\/1.5\",\"series\":\"f1\",\"url\":\"https://ergast.com/api/f1/2015.json\",\"limit\":\"30\",\"offset\":\"0\",\"total\":\"19\",\"RaceTable\":{\"season\":\"2015\",\"Races\":[{\"season\":\"2015\",\"round\":\"1\",\"url\":\"http:\\/\\/en.wikipedia.org\\/wiki\\/2015_Australian_Grand_Prix\",\"raceName\":\"Australian Grand Prix\",\"Circuit\":{\"circuitId\":\"albert_park\",\"url\":\"http:\\/\\/en.wikipedia.org\\/wiki\\/Melbourne_Grand_Prix_Circuit\",\"circuitName\":\"Albert Park Grand Prix Circuit\",\"Location\":{\"lat\":\"-37.8497\",\"long\":\"144.968\",\"locality\":\"Melbourne\",\"country\":\"Australia\"}},\"date\":\"2015-03-15\",\"time\":\"05:00:00Z\"},{\"season\":\"2015\",\"round\":\"2\",\"url\":\"http:\\/\\/en.wikipedia.org\\/wiki\\/2015_Malaysian_Grand_Prix\",\"raceName\":\"Malaysian Grand Prix\",\"Circuit\":{\"circuitId\":\"sepang\",\"url\":\"http:\\/\\/en.wikipedia.org\\/wiki\\/Sepang_International_Circuit\",\"circuitName\":\"Sepang International Circuit\",\"Location\":{\"lat\":\"2.76083\",\"long\":\"101.738\",\"locality\":\"Kuala Lumpur\",\"country\":\"Malaysia\"}},\"date\":\"2015-03-29\",\"time\":\"07:00:00Z\"},{\"season\":\"2015\",\"round\":\"3\",\"url\":\"http:\\/\\/en.wikipedia.org\\/wiki\\/2015_Chinese_Grand_Prix\",\"raceName\":\"Chinese Grand Prix\",\"Circuit\":{\"circuitId\":\"shanghai\",\"url\":\"http:\\/\\/en.wikipedia.org\\/wiki\\/Shanghai_International_Circuit\",\"circuitName\":\"Shanghai International Circuit\",\"Location\":{\"lat\":\"31.3389\",\"long\":\"121.22\",\"locality\":\"Shanghai\",\"country\":\"China\"}},\"date\":\"2015-04-12\",\"time\":\"06:00:00Z\"},{\"season\":\"2015\",\"round\":\"4\",\"url\":\"http:\\/\\/en.wikipedia.org\\/wiki\\/2015_Bahrain_Grand_Prix\",\"raceName\":\"Bahrain Grand Prix\",\"Circuit\":{\"circuitId\":\"bahrain\",\"url\":\"http:\\/\\/en.wikipedia.org\\/wiki\\/Bahrain_International_Circuit\",\"circuitName\":\"Bahrain International Circuit\",\"Location\":{\"lat\":\"26.0325\",\"long\":\"50.5106\",\"locality\":\"Sakhir\",\"country\":\"Bahrain\"}},\"date\":\"2015-04-19\",\"time\":\"15:00:00Z\"},{\"season\":\"2015\",\"round\":\"5\",\"url\":\"http:\\/\\/en.wikipedia.org\\/wiki\\/2015_Spanish_Grand_Prix\",\"raceName\":\"Spanish Grand Prix\",\"Circuit\":{\"circuitId\":\"catalunya\",\"url\":\"http:\\/\\/en.wikipedia.org\\/wiki\\/Circuit_de_Barcelona-Catalunya\",\"circuitName\":\"Circuit de Barcelona-Catalunya\",\"Location\":{\"lat\":\"41.57\",\"long\":\"2.26111\",\"locality\":\"Montmel√≥\",\"country\":\"Spain\"}},\"date\":\"2015-05-10\",\"time\":\"12:00:00Z\"},{\"season\":\"2015\",\"round\":\"6\",\"url\":\"http:\\/\\/en.wikipedia.org\\/wiki\\/2015_Monaco_Grand_Prix\",\"raceName\":\"Monaco Grand Prix\",\"Circuit\":{\"circuitId\":\"monaco\",\"url\":\"http:\\/\\/en.wikipedia.org\\/wiki\\/Circuit_de_Monaco\",\"circuitName\":\"Circuit de Monaco\",\"Location\":{\"lat\":\"43.7347\",\"long\":\"7.42056\",\"locality\":\"Monte-Carlo\",\"country\":\"Monaco\"}},\"date\":\"2015-05-24\",\"time\":\"12:00:00Z\"},{\"season\":\"2015\",\"round\":\"7\",\"url\":\"http:\\/\\/en.wikipedia.org\\/wiki\\/2015_Canadian_Grand_Prix\",\"raceName\":\"Canadian Grand Prix\",\"Circuit\":{\"circuitId\":\"villeneuve\",\"url\":\"http:\\/\\/en.wikipedia.org\\/wiki\\/Circuit_Gilles_Villeneuve\",\"circuitName\":\"Circuit Gilles Villeneuve\",\"Location\":{\"lat\":\"45.5\",\"long\":\"-73.5228\",\"locality\":\"Montreal\",\"country\":\"Canada\"}},\"date\":\"2015-06-07\",\"time\":\"18:00:00Z\"},{\"season\":\"2015\",\"round\":\"8\",\"url\":\"http:\\/\\/en.wikipedia.org\\/wiki\\/2015_Austrian_Grand_Prix\",\"raceName\":\"Austrian Grand Prix\",\"Circuit\":{\"circuitId\":\"red_bull_ring\",\"url\":\"http:\\/\\/en.wikipedia.org\\/wiki\\/Red_Bull_Ring\",\"circuitName\":\"Red Bull Ring\",\"Location\":{\"lat\":\"47.2197\",\"long\":\"14.7647\",\"locality\":\"Spielberg\",\"country\":\"Austria\"}},\"date\":\"2015-06-21\",\"time\":\"12:00:00Z\"},{\"season\":\"2015\",\"round\":\"9\",\"url\":\"http:\\/\\/en.wikipedia.org\\/wiki\\/2015_British_Grand_Prix\",\"raceName\":\"British Grand Prix\",\"Circuit\":{\"circuitId\":\"silverstone\",\"url\":\"http:\\/\\/en.wikipedia.org\\/wiki\\/Silverstone_Circuit\",\"circuitName\":\"Silverstone Circuit\",\"Location\":{\"lat\":\"52.0786\",\"long\":\"-1.01694\",\"locality\":\"Silverstone\",\"country\":\"UK\"}},\"date\":\"2015-07-05\",\"time\":\"12:00:00Z\"},{\"season\":\"2015\",\"round\":\"10\",\"url\":\"http:\\/\\/en.wikipedia.org\\/wiki\\/2015_Hungarian_Grand_Prix\",\"raceName\":\"Hungarian Grand Prix\",\"Circuit\":{\"circuitId\":\"hungaroring\",\"url\":\"http:\\/\\/en.wikipedia.org\\/wiki\\/Hungaroring\",\"circuitName\":\"Hungaroring\",\"Location\":{\"lat\":\"47.5789\",\"long\":\"19.2486\",\"locality\":\"Budapest\",\"country\":\"Hungary\"}},\"date\":\"2015-07-26\",\"time\":\"12:00:00Z\"},{\"season\":\"2015\",\"round\":\"11\",\"url\":\"http:\\/\\/en.wikipedia.org\\/wiki\\/2015_Belgian_Grand_Prix\",\"raceName\":\"Belgian Grand Prix\",\"Circuit\":{\"circuitId\":\"spa\",\"url\":\"http:\\/\\/en.wikipedia.org\\/wiki\\/Circuit_de_Spa-Francorchamps\",\"circuitName\":\"Circuit de Spa-Francorchamps\",\"Location\":{\"lat\":\"50.4372\",\"long\":\"5.97139\",\"locality\":\"Spa\",\"country\":\"Belgium\"}},\"date\":\"2015-08-23\",\"time\":\"12:00:00Z\"},{\"season\":\"2015\",\"round\":\"12\",\"url\":\"http:\\/\\/en.wikipedia.org\\/wiki\\/2015_Italian_Grand_Prix\",\"raceName\":\"Italian Grand Prix\",\"Circuit\":{\"circuitId\":\"monza\",\"url\":\"http:\\/\\/en.wikipedia.org\\/wiki\\/Autodromo_Nazionale_Monza\",\"circuitName\":\"Autodromo Nazionale di Monza\",\"Location\":{\"lat\":\"45.6156\",\"long\":\"9.28111\",\"locality\":\"Monza\",\"country\":\"Italy\"}},\"date\":\"2015-09-06\",\"time\":\"12:00:00Z\"},{\"season\":\"2015\",\"round\":\"13\",\"url\":\"http:\\/\\/en.wikipedia.org\\/wiki\\/2015_Singapore_Grand_Prix\",\"raceName\":\"Singapore Grand Prix\",\"Circuit\":{\"circuitId\":\"marina_bay\",\"url\":\"http:\\/\\/en.wikipedia.org\\/wiki\\/Marina_Bay_Street_Circuit\",\"circuitName\":\"Marina Bay Street Circuit\",\"Location\":{\"lat\":\"1.2914\",\"long\":\"103.864\",\"locality\":\"Marina Bay\",\"country\":\"Singapore\"}},\"date\":\"2015-09-20\",\"time\":\"12:00:00Z\"},{\"season\":\"2015\",\"round\":\"14\",\"url\":\"http:\\/\\/en.wikipedia.org\\/wiki\\/2015_Japanese_Grand_Prix\",\"raceName\":\"Japanese Grand Prix\",\"Circuit\":{\"circuitId\":\"suzuka\",\"url\":\"http:\\/\\/en.wikipedia.org\\/wiki\\/Suzuka_Circuit\",\"circuitName\":\"Suzuka Circuit\",\"Location\":{\"lat\":\"34.8431\",\"long\":\"136.541\",\"locality\":\"Suzuka\",\"country\":\"Japan\"}},\"date\":\"2015-09-27\",\"time\":\"05:00:00Z\"},{\"season\":\"2015\",\"round\":\"15\",\"url\":\"http:\\/\\/en.wikipedia.org\\/wiki\\/2015_Russian_Grand_Prix\",\"raceName\":\"Russian Grand Prix\",\"Circuit\":{\"circuitId\":\"sochi\",\"url\":\"http:\\/\\/en.wikipedia.org\\/wiki\\/Sochi_Autodrom\",\"circuitName\":\"Sochi Autodrom\",\"Location\":{\"lat\":\"43.4057\",\"long\":\"39.9578\",\"locality\":\"Sochi\",\"country\":\"Russia\"}},\"date\":\"2015-10-11\",\"time\":\"11:00:00Z\"},{\"season\":\"2015\",\"round\":\"16\",\"url\":\"http:\\/\\/en.wikipedia.org\\/wiki\\/2015_United_States_Grand_Prix\",\"raceName\":\"United States Grand Prix\",\"Circuit\":{\"circuitId\":\"americas\",\"url\":\"http:\\/\\/en.wikipedia.org\\/wiki\\/Circuit_of_the_Americas\",\"circuitName\":\"Circuit of the Americas\",\"Location\":{\"lat\":\"30.1328\",\"long\":\"-97.6411\",\"locality\":\"Austin\",\"country\":\"USA\"}},\"date\":\"2015-10-25\",\"time\":\"19:00:00Z\"},{\"season\":\"2015\",\"round\":\"17\",\"url\":\"http:\\/\\/en.wikipedia.org\\/wiki\\/2015_Mexican_Grand_Prix\",\"raceName\":\"Mexican Grand Prix\",\"Circuit\":{\"circuitId\":\"rodriguez\",\"url\":\"http:\\/\\/en.wikipedia.org\\/wiki\\/Aut%C3%B3dromo_Hermanos_Rodr%C3%ADguez\",\"circuitName\":\"Aut√≥dromo Hermanos Rodr√≠guez\",\"Location\":{\"lat\":\"19.4042\",\"long\":\"-99.0907\",\"locality\":\"Mexico City\",\"country\":\"Mexico\"}},\"date\":\"2015-11-01\",\"time\":\"19:00:00Z\"},{\"season\":\"2015\",\"round\":\"18\",\"url\":\"http:\\/\\/en.wikipedia.org\\/wiki\\/2015_Brazilian_Grand_Prix\",\"raceName\":\"Brazilian Grand Prix\",\"Circuit\":{\"circuitId\":\"interlagos\",\"url\":\"http:\\/\\/en.wikipedia.org\\/wiki\\/Aut%C3%B3dromo_Jos%C3%A9_Carlos_Pace\",\"circuitName\":\"Aut√≥dromo Jos√© Carlos Pace\",\"Location\":{\"lat\":\"-23.7036\",\"long\":\"-46.6997\",\"locality\":\"S√£o Paulo\",\"country\":\"Brazil\"}},\"date\":\"2015-11-15\",\"time\":\"16:00:00Z\"},{\"season\":\"2015\",\"round\":\"19\",\"url\":\"http:\\/\\/en.wikipedia.org\\/wiki\\/2015_Abu_Dhabi_Grand_Prix\",\"raceName\":\"Abu Dhabi Grand Prix\",\"Circuit\":{\"circuitId\":\"yas_marina\",\"url\":\"http:\\/\\/en.wikipedia.org\\/wiki\\/Yas_Marina_Circuit\",\"circuitName\":\"Yas Marina Circuit\",\"Location\":{\"lat\":\"24.4672\",\"long\":\"54.6031\",\"locality\":\"Abu Dhabi\",\"country\":\"UAE\"}},\"date\":\"2015-11-29\",\"time\":\"13:00:00Z\"}]}}}";
        ObjectMapper mapper = new ObjectMapper();
        CompletableFuture<ErgastResponse<ErgastRace>> data = null;

        try {
            ErgastResponse<ErgastRace> responseData = mapper.readValue(jsonResponse, new TypeReference<ErgastResponse<ErgastRace>>() {});
            data = CompletableFuture.supplyAsync(() -> responseData);
        } catch(Exception exc) {
            System.out.println(exc.getMessage());
        }
        return data;
    }

    private CompletableFuture<ErgastResponse<ErgastRace>> raceResultData() {
        String jsonResponse = "{\"MRData\":{\"xmlns\":\"http:\\/\\/ergast.com\\/mrd\\/1.5\",\"series\":\"f1\",\"url\":\"http://ergast.com/api/f1/2015/3/results.json\",\"limit\":\"30\",\"offset\":\"0\",\"total\":\"20\",\"RaceTable\":{\"season\":\"2015\",\"round\":\"3\",\"Races\":[{\"season\":\"2015\",\"round\":\"3\",\"url\":\"http:\\/\\/en.wikipedia.org\\/wiki\\/2015_Chinese_Grand_Prix\",\"raceName\":\"Chinese Grand Prix\",\"Circuit\":{\"circuitId\":\"shanghai\",\"url\":\"https://en.wikipedia.org/wiki/Shanghai_International_Circuit\",\"circuitName\":\"Shanghai International Circuit\",\"Location\":{\"lat\":\"31.3389\",\"long\":\"121.22\",\"locality\":\"Shanghai\",\"country\":\"China\"}},\"date\":\"2015-04-12\",\"time\":\"06:00:00Z\",\"Results\":[{\"number\":\"44\",\"position\":\"1\",\"positionText\":\"1\",\"points\":\"25\",\"Driver\":{\"driverId\":\"hamilton\",\"permanentNumber\":\"44\",\"code\":\"HAM\",\"url\":\"http:\\/\\/en.wikipedia.org\\/wiki\\/Lewis_Hamilton\",\"givenName\":\"Lewis\",\"familyName\":\"Hamilton\",\"dateOfBirth\":\"1985-01-07\",\"nationality\":\"British\"},\"Constructor\":{\"constructorId\":\"mercedes\",\"url\":\"http:\\/\\/en.wikipedia.org\\/wiki\\/Mercedes-Benz_in_Formula_One\",\"name\":\"Mercedes\",\"nationality\":\"German\"},\"grid\":\"1\",\"laps\":\"56\",\"status\":\"Finished\",\"Time\":{\"millis\":\"5982008\",\"time\":\"1:39:42.008\"},\"FastestLap\":{\"rank\":\"1\",\"lap\":\"31\",\"Time\":{\"time\":\"1:42.208\"},\"AverageSpeed\":{\"units\":\"kph\",\"speed\":\"191.996\"}}},{\"number\":\"6\",\"position\":\"2\",\"positionText\":\"2\",\"points\":\"18\",\"Driver\":{\"driverId\":\"rosberg\",\"permanentNumber\":\"6\",\"code\":\"ROS\",\"url\":\"http:\\/\\/en.wikipedia.org\\/wiki\\/Nico_Rosberg\",\"givenName\":\"Nico\",\"familyName\":\"Rosberg\",\"dateOfBirth\":\"1985-06-27\",\"nationality\":\"German\"},\"Constructor\":{\"constructorId\":\"mercedes\",\"url\":\"http:\\/\\/en.wikipedia.org\\/wiki\\/Mercedes-Benz_in_Formula_One\",\"name\":\"Mercedes\",\"nationality\":\"German\"},\"grid\":\"2\",\"laps\":\"56\",\"status\":\"Finished\",\"Time\":{\"millis\":\"5982722\",\"time\":\"+0.714\"},\"FastestLap\":{\"rank\":\"2\",\"lap\":\"39\",\"Time\":{\"time\":\"1:42.565\"},\"AverageSpeed\":{\"units\":\"kph\",\"speed\":\"191.328\"}}},{\"number\":\"5\",\"position\":\"3\",\"positionText\":\"3\",\"points\":\"15\",\"Driver\":{\"driverId\":\"vettel\",\"permanentNumber\":\"5\",\"code\":\"VET\",\"url\":\"http:\\/\\/en.wikipedia.org\\/wiki\\/Sebastian_Vettel\",\"givenName\":\"Sebastian\",\"familyName\":\"Vettel\",\"dateOfBirth\":\"1987-07-03\",\"nationality\":\"German\"},\"Constructor\":{\"constructorId\":\"ferrari\",\"url\":\"http:\\/\\/en.wikipedia.org\\/wiki\\/Scuderia_Ferrari\",\"name\":\"Ferrari\",\"nationality\":\"Italian\"},\"grid\":\"3\",\"laps\":\"56\",\"status\":\"Finished\",\"Time\":{\"millis\":\"5984996\",\"time\":\"+2.988\"},\"FastestLap\":{\"rank\":\"5\",\"lap\":\"15\",\"Time\":{\"time\":\"1:43.018\"},\"AverageSpeed\":{\"units\":\"kph\",\"speed\":\"190.487\"}}},{\"number\":\"7\",\"position\":\"4\",\"positionText\":\"4\",\"points\":\"12\",\"Driver\":{\"driverId\":\"raikkonen\",\"permanentNumber\":\"7\",\"code\":\"RAI\",\"url\":\"http:\\/\\/en.wikipedia.org\\/wiki\\/Kimi_R%C3%A4ikk%C3%B6nen\",\"givenName\":\"Kimi\",\"familyName\":\"R√§ikk√∂nen\",\"dateOfBirth\":\"1979-10-17\",\"nationality\":\"Finnish\"},\"Constructor\":{\"constructorId\":\"ferrari\",\"url\":\"http:\\/\\/en.wikipedia.org\\/wiki\\/Scuderia_Ferrari\",\"name\":\"Ferrari\",\"nationality\":\"Italian\"},\"grid\":\"6\",\"laps\":\"56\",\"status\":\"Finished\",\"Time\":{\"millis\":\"5985843\",\"time\":\"+3.835\"},\"FastestLap\":{\"rank\":\"6\",\"lap\":\"48\",\"Time\":{\"time\":\"1:43.026\"},\"AverageSpeed\":{\"units\":\"kph\",\"speed\":\"190.472\"}}},{\"number\":\"19\",\"position\":\"5\",\"positionText\":\"5\",\"points\":\"10\",\"Driver\":{\"driverId\":\"massa\",\"permanentNumber\":\"19\",\"code\":\"MAS\",\"url\":\"http:\\/\\/en.wikipedia.org\\/wiki\\/Felipe_Massa\",\"givenName\":\"Felipe\",\"familyName\":\"Massa\",\"dateOfBirth\":\"1981-04-25\",\"nationality\":\"Brazilian\"},\"Constructor\":{\"constructorId\":\"williams\",\"url\":\"http:\\/\\/en.wikipedia.org\\/wiki\\/Williams_Grand_Prix_Engineering\",\"name\":\"Williams\",\"nationality\":\"British\"},\"grid\":\"4\",\"laps\":\"56\",\"status\":\"Finished\",\"Time\":{\"millis\":\"5990552\",\"time\":\"+8.544\"},\"FastestLap\":{\"rank\":\"4\",\"lap\":\"37\",\"Time\":{\"time\":\"1:42.734\"},\"AverageSpeed\":{\"units\":\"kph\",\"speed\":\"191.013\"}}},{\"number\":\"77\",\"position\":\"6\",\"positionText\":\"6\",\"points\":\"8\",\"Driver\":{\"driverId\":\"bottas\",\"permanentNumber\":\"77\",\"code\":\"BOT\",\"url\":\"http:\\/\\/en.wikipedia.org\\/wiki\\/Valtteri_Bottas\",\"givenName\":\"Valtteri\",\"familyName\":\"Bottas\",\"dateOfBirth\":\"1989-08-28\",\"nationality\":\"Finnish\"},\"Constructor\":{\"constructorId\":\"williams\",\"url\":\"http:\\/\\/en.wikipedia.org\\/wiki\\/Williams_Grand_Prix_Engineering\",\"name\":\"Williams\",\"nationality\":\"British\"},\"grid\":\"5\",\"laps\":\"56\",\"status\":\"Finished\",\"Time\":{\"millis\":\"5991893\",\"time\":\"+9.885\"},\"FastestLap\":{\"rank\":\"7\",\"lap\":\"37\",\"Time\":{\"time\":\"1:43.051\"},\"AverageSpeed\":{\"units\":\"kph\",\"speed\":\"190.426\"}}},{\"number\":\"8\",\"position\":\"7\",\"positionText\":\"7\",\"points\":\"6\",\"Driver\":{\"driverId\":\"grosjean\",\"permanentNumber\":\"8\",\"code\":\"GRO\",\"url\":\"http:\\/\\/en.wikipedia.org\\/wiki\\/Romain_Grosjean\",\"givenName\":\"Romain\",\"familyName\":\"Grosjean\",\"dateOfBirth\":\"1986-04-17\",\"nationality\":\"French\"},\"Constructor\":{\"constructorId\":\"lotus_f1\",\"url\":\"http:\\/\\/en.wikipedia.org\\/wiki\\/Lotus_F1\",\"name\":\"Lotus F1\",\"nationality\":\"British\"},\"grid\":\"8\",\"laps\":\"56\",\"status\":\"Finished\",\"Time\":{\"millis\":\"6001016\",\"time\":\"+19.008\"},\"FastestLap\":{\"rank\":\"8\",\"lap\":\"34\",\"Time\":{\"time\":\"1:43.134\"},\"AverageSpeed\":{\"units\":\"kph\",\"speed\":\"190.272\"}}},{\"number\":\"12\",\"position\":\"8\",\"positionText\":\"8\",\"points\":\"4\",\"Driver\":{\"driverId\":\"nasr\",\"permanentNumber\":\"12\",\"code\":\"NAS\",\"url\":\"http:\\/\\/en.wikipedia.org\\/wiki\\/Felipe_Nasr\",\"givenName\":\"Felipe\",\"familyName\":\"Nasr\",\"dateOfBirth\":\"1992-08-21\",\"nationality\":\"Brazilian\"},\"Constructor\":{\"constructorId\":\"sauber\",\"url\":\"http:\\/\\/en.wikipedia.org\\/wiki\\/Sauber\",\"name\":\"Sauber\",\"nationality\":\"Swiss\"},\"grid\":\"9\",\"laps\":\"56\",\"status\":\"Finished\",\"Time\":{\"millis\":\"6004633\",\"time\":\"+22.625\"},\"FastestLap\":{\"rank\":\"12\",\"lap\":\"46\",\"Time\":{\"time\":\"1:43.692\"},\"AverageSpeed\":{\"units\":\"kph\",\"speed\":\"189.248\"}}},{\"number\":\"3\",\"position\":\"9\",\"positionText\":\"9\",\"points\":\"2\",\"Driver\":{\"driverId\":\"ricciardo\",\"permanentNumber\":\"3\",\"code\":\"RIC\",\"url\":\"http:\\/\\/en.wikipedia.org\\/wiki\\/Daniel_Ricciardo\",\"givenName\":\"Daniel\",\"familyName\":\"Ricciardo\",\"dateOfBirth\":\"1989-07-01\",\"nationality\":\"Australian\"},\"Constructor\":{\"constructorId\":\"red_bull\",\"url\":\"http:\\/\\/en.wikipedia.org\\/wiki\\/Red_Bull_Racing\",\"name\":\"Red Bull\",\"nationality\":\"Austrian\"},\"grid\":\"7\",\"laps\":\"56\",\"status\":\"Finished\",\"Time\":{\"millis\":\"6014125\",\"time\":\"+32.117\"},\"FastestLap\":{\"rank\":\"9\",\"lap\":\"46\",\"Time\":{\"time\":\"1:43.245\"},\"AverageSpeed\":{\"units\":\"kph\",\"speed\":\"190.068\"}}},{\"number\":\"9\",\"position\":\"10\",\"positionText\":\"10\",\"points\":\"1\",\"Driver\":{\"driverId\":\"ericsson\",\"permanentNumber\":\"9\",\"code\":\"ERI\",\"url\":\"http:\\/\\/en.wikipedia.org\\/wiki\\/Marcus_Ericsson\",\"givenName\":\"Marcus\",\"familyName\":\"Ericsson\",\"dateOfBirth\":\"1990-09-02\",\"nationality\":\"Swedish\"},\"Constructor\":{\"constructorId\":\"sauber\",\"url\":\"http:\\/\\/en.wikipedia.org\\/wiki\\/Sauber\",\"name\":\"Sauber\",\"nationality\":\"Swiss\"},\"grid\":\"10\",\"laps\":\"55\",\"status\":\"+1 Lap\",\"FastestLap\":{\"rank\":\"15\",\"lap\":\"32\",\"Time\":{\"time\":\"1:44.204\"},\"AverageSpeed\":{\"units\":\"kph\",\"speed\":\"188.319\"}}},{\"number\":\"11\",\"position\":\"11\",\"positionText\":\"11\",\"points\":\"0\",\"Driver\":{\"driverId\":\"perez\",\"permanentNumber\":\"11\",\"code\":\"PER\",\"url\":\"http:\\/\\/en.wikipedia.org\\/wiki\\/Sergio_P%C3%A9rez\",\"givenName\":\"Sergio\",\"familyName\":\"P√©rez\",\"dateOfBirth\":\"1990-01-26\",\"nationality\":\"Mexican\"},\"Constructor\":{\"constructorId\":\"force_india\",\"url\":\"http:\\/\\/en.wikipedia.org\\/wiki\\/Racing_Point_Force_India\",\"name\":\"Force India\",\"nationality\":\"Indian\"},\"grid\":\"15\",\"laps\":\"55\",\"status\":\"+1 Lap\",\"FastestLap\":{\"rank\":\"10\",\"lap\":\"44\",\"Time\":{\"time\":\"1:43.512\"},\"AverageSpeed\":{\"units\":\"kph\",\"speed\":\"189.578\"}}},{\"number\":\"14\",\"position\":\"12\",\"positionText\":\"12\",\"points\":\"0\",\"Driver\":{\"driverId\":\"alonso\",\"permanentNumber\":\"14\",\"code\":\"ALO\",\"url\":\"http:\\/\\/en.wikipedia.org\\/wiki\\/Fernando_Alonso\",\"givenName\":\"Fernando\",\"familyName\":\"Alonso\",\"dateOfBirth\":\"1981-07-29\",\"nationality\":\"Spanish\"},\"Constructor\":{\"constructorId\":\"mclaren\",\"url\":\"http:\\/\\/en.wikipedia.org\\/wiki\\/McLaren\",\"name\":\"McLaren\",\"nationality\":\"British\"},\"grid\":\"18\",\"laps\":\"55\",\"status\":\"+1 Lap\",\"FastestLap\":{\"rank\":\"13\",\"lap\":\"40\",\"Time\":{\"time\":\"1:43.728\"},\"AverageSpeed\":{\"units\":\"kph\",\"speed\":\"189.183\"}}},{\"number\":\"55\",\"position\":\"13\",\"positionText\":\"13\",\"points\":\"0\",\"Driver\":{\"driverId\":\"sainz\",\"permanentNumber\":\"55\",\"code\":\"SAI\",\"url\":\"http:\\/\\/en.wikipedia.org\\/wiki\\/Carlos_Sainz_Jr.\",\"givenName\":\"Carlos\",\"familyName\":\"Sainz\",\"dateOfBirth\":\"1994-09-01\",\"nationality\":\"Spanish\"},\"Constructor\":{\"constructorId\":\"toro_rosso\",\"url\":\"http:\\/\\/en.wikipedia.org\\/wiki\\/Scuderia_Toro_Rosso\",\"name\":\"Toro Rosso\",\"nationality\":\"Italian\"},\"grid\":\"14\",\"laps\":\"55\",\"status\":\"+1 Lap\",\"FastestLap\":{\"rank\":\"3\",\"lap\":\"41\",\"Time\":{\"time\":\"1:42.652\"},\"AverageSpeed\":{\"units\":\"kph\",\"speed\":\"191.166\"}}},{\"number\":\"22\",\"position\":\"14\",\"positionText\":\"14\",\"points\":\"0\",\"Driver\":{\"driverId\":\"button\",\"permanentNumber\":\"22\",\"code\":\"BUT\",\"url\":\"http:\\/\\/en.wikipedia.org\\/wiki\\/Jenson_Button\",\"givenName\":\"Jenson\",\"familyName\":\"Button\",\"dateOfBirth\":\"1980-01-19\",\"nationality\":\"British\"},\"Constructor\":{\"constructorId\":\"mclaren\",\"url\":\"http:\\/\\/en.wikipedia.org\\/wiki\\/McLaren\",\"name\":\"McLaren\",\"nationality\":\"British\"},\"grid\":\"17\",\"laps\":\"55\",\"status\":\"+1 Lap\",\"FastestLap\":{\"rank\":\"16\",\"lap\":\"21\",\"Time\":{\"time\":\"1:44.991\"},\"AverageSpeed\":{\"units\":\"kph\",\"speed\":\"186.907\"}}},{\"number\":\"28\",\"position\":\"15\",\"positionText\":\"15\",\"points\":\"0\",\"Driver\":{\"driverId\":\"stevens\",\"permanentNumber\":\"28\",\"code\":\"STE\",\"url\":\"http:\\/\\/en.wikipedia.org\\/wiki\\/Will_Stevens\",\"givenName\":\"Will\",\"familyName\":\"Stevens\",\"dateOfBirth\":\"1991-06-28\",\"nationality\":\"British\"},\"Constructor\":{\"constructorId\":\"manor\",\"url\":\"http:\\/\\/en.wikipedia.org\\/wiki\\/Manor_Motorsport\",\"name\":\"Manor Marussia\",\"nationality\":\"British\"},\"grid\":\"19\",\"laps\":\"54\",\"status\":\"+2 Laps\",\"FastestLap\":{\"rank\":\"17\",\"lap\":\"40\",\"Time\":{\"time\":\"1:45.414\"},\"AverageSpeed\":{\"units\":\"kph\",\"speed\":\"186.157\"}}},{\"number\":\"98\",\"position\":\"16\",\"positionText\":\"16\",\"points\":\"0\",\"Driver\":{\"driverId\":\"merhi\",\"permanentNumber\":\"98\",\"code\":\"MER\",\"url\":\"http:\\/\\/en.wikipedia.org\\/wiki\\/Roberto_Merhi\",\"givenName\":\"Roberto\",\"familyName\":\"Merhi\",\"dateOfBirth\":\"1991-03-22\",\"nationality\":\"Spanish\"},\"Constructor\":{\"constructorId\":\"manor\",\"url\":\"http:\\/\\/en.wikipedia.org\\/wiki\\/Manor_Motorsport\",\"name\":\"Manor Marussia\",\"nationality\":\"British\"},\"grid\":\"20\",\"laps\":\"54\",\"status\":\"+2 Laps\",\"FastestLap\":{\"rank\":\"19\",\"lap\":\"43\",\"Time\":{\"time\":\"1:45.963\"},\"AverageSpeed\":{\"units\":\"kph\",\"speed\":\"185.192\"}}},{\"number\":\"33\",\"position\":\"17\",\"positionText\":\"17\",\"points\":\"0\",\"Driver\":{\"driverId\":\"max_verstappen\",\"permanentNumber\":\"33\",\"code\":\"VER\",\"url\":\"http:\\/\\/en.wikipedia.org\\/wiki\\/Max_Verstappen\",\"givenName\":\"Max\",\"familyName\":\"Verstappen\",\"dateOfBirth\":\"1997-09-30\",\"nationality\":\"Dutch\"},\"Constructor\":{\"constructorId\":\"toro_rosso\",\"url\":\"http:\\/\\/en.wikipedia.org\\/wiki\\/Scuderia_Toro_Rosso\",\"name\":\"Toro Rosso\",\"nationality\":\"Italian\"},\"grid\":\"13\",\"laps\":\"52\",\"status\":\"Transmission\",\"FastestLap\":{\"rank\":\"14\",\"lap\":\"46\",\"Time\":{\"time\":\"1:43.880\"},\"AverageSpeed\":{\"units\":\"kph\",\"speed\":\"188.906\"}}},{\"number\":\"13\",\"position\":\"18\",\"positionText\":\"R\",\"points\":\"0\",\"Driver\":{\"driverId\":\"maldonado\",\"permanentNumber\":\"13\",\"code\":\"MAL\",\"url\":\"http:\\/\\/en.wikipedia.org\\/wiki\\/Pastor_Maldonado\",\"givenName\":\"Pastor\",\"familyName\":\"Maldonado\",\"dateOfBirth\":\"1985-03-09\",\"nationality\":\"Venezuelan\"},\"Constructor\":{\"constructorId\":\"lotus_f1\",\"url\":\"http:\\/\\/en.wikipedia.org\\/wiki\\/Lotus_F1\",\"name\":\"Lotus F1\",\"nationality\":\"British\"},\"grid\":\"11\",\"laps\":\"49\",\"status\":\"Brakes\",\"FastestLap\":{\"rank\":\"11\",\"lap\":\"37\",\"Time\":{\"time\":\"1:43.686\"},\"AverageSpeed\":{\"units\":\"kph\",\"speed\":\"189.259\"}}},{\"number\":\"26\",\"position\":\"19\",\"positionText\":\"R\",\"points\":\"0\",\"Driver\":{\"driverId\":\"kvyat\",\"permanentNumber\":\"26\",\"code\":\"KVY\",\"url\":\"http:\\/\\/en.wikipedia.org\\/wiki\\/Daniil_Kvyat\",\"givenName\":\"Daniil\",\"familyName\":\"Kvyat\",\"dateOfBirth\":\"1994-04-26\",\"nationality\":\"Russian\"},\"Constructor\":{\"constructorId\":\"red_bull\",\"url\":\"http:\\/\\/en.wikipedia.org\\/wiki\\/Red_Bull_Racing\",\"name\":\"Red Bull\",\"nationality\":\"Austrian\"},\"grid\":\"12\",\"laps\":\"15\",\"status\":\"Power Unit\",\"FastestLap\":{\"rank\":\"20\",\"lap\":\"13\",\"Time\":{\"time\":\"1:46.291\"},\"AverageSpeed\":{\"units\":\"kph\",\"speed\":\"184.621\"}}},{\"number\":\"27\",\"position\":\"20\",\"positionText\":\"R\",\"points\":\"0\",\"Driver\":{\"driverId\":\"hulkenberg\",\"permanentNumber\":\"27\",\"code\":\"HUL\",\"url\":\"http:\\/\\/en.wikipedia.org\\/wiki\\/Nico_H%C3%BClkenberg\",\"givenName\":\"Nico\",\"familyName\":\"H√ºlkenberg\",\"dateOfBirth\":\"1987-08-19\",\"nationality\":\"German\"},\"Constructor\":{\"constructorId\":\"force_india\",\"url\":\"http:\\/\\/en.wikipedia.org\\/wiki\\/Racing_Point_Force_India\",\"name\":\"Force India\",\"nationality\":\"Indian\"},\"grid\":\"16\",\"laps\":\"9\",\"status\":\"Gearbox\",\"FastestLap\":{\"rank\":\"18\",\"lap\":\"6\",\"Time\":{\"time\":\"1:45.844\"},\"AverageSpeed\":{\"units\":\"kph\",\"speed\":\"185.401\"}}}]}]}}}";
        ObjectMapper mapper = new ObjectMapper();
        CompletableFuture<ErgastResponse<ErgastRace>> data = null;

        try {
            ErgastResponse<ErgastRace> responseData = mapper.readValue(jsonResponse, new TypeReference<ErgastResponse<ErgastRace>>() {});
            data = CompletableFuture.supplyAsync(() -> responseData);
        } catch(Exception exc) {
            System.out.println(exc.getMessage());
        }
        return data;
    }
}